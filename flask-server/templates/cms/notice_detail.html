{% extends "common/cms_base.html" %}

{% block title %}
    {% if notice %}
        {% if view_only %}
        【HorizonSafe 界安】---查看公告
        {% else %}
        【HorizonSafe 界安】---编辑公告
        {% endif %}
    {% else %}
    【HorizonSafe 界安】---添加公告
    {% endif %}
{% endblock %}

{% block css %}
    <style>
        .form-container {
            background-color: white;
            border-radius: 8px;
            padding: 30px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            max-width: 800px;
            margin: 0 auto;
        }
        
        .form-title {
            font-size: 24px;
            font-weight: bold;
            margin-bottom: 30px;
            border-bottom: 1px solid #e9ecef;
            padding-bottom: 15px;
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        .form-label {
            font-weight: bold;
            margin-bottom: 8px;
            display: block;
        }
        
        .form-control {
            width: 100%;
            padding: 10px;
            border: 1px solid #ced4da;
            border-radius: 4px;
            font-size: 16px;
        }
        
        .form-control:focus {
            border-color: #80bdff;
            outline: none;
            box-shadow: 0 0 0 0.2rem rgba(0,123,255,.25);
        }
        
        .form-text {
            color: #6c757d;
            font-size: 14px;
            margin-top: 5px;
        }
        
        .btn-container {
            display: flex;
            justify-content: flex-end;
            gap: 10px;
            margin-top: 30px;
        }
        
        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-weight: bold;
        }
        
        .btn-primary {
            background-color: #007bff;
            color: white;
        }
        
        .btn-primary:hover {
            background-color: #0069d9;
        }
        
        .btn-secondary {
            background-color: #6c757d;
            color: white;
        }
        
        .btn-secondary:hover {
            background-color: #5a6268;
        }
        
        .required-marker {
            color: #dc3545;
            margin-left: 5px;
        }
        
        .radio-group {
            display: flex;
            gap: 20px;
        }
        
        .radio-option {
            display: flex;
            align-items: center;
            cursor: pointer;
        }
        
        .radio-option input {
            margin-right: 8px;
        }
        
        .view-container {
            margin-top: 10px;
        }
        
        .view-label {
            font-weight: bold;
            color: #495057;
            margin-bottom: 5px;
        }
        
        .view-content {
            background-color: #f8f9fa;
            padding: 15px;
            border-radius: 4px;
            margin-bottom: 20px;
            white-space: pre-wrap;
            line-height: 1.6;
        }
        
        .notice-content {
            min-height: 200px;
        }
    </style>
{% endblock %}

{% block content %}
    <div class="form-container">
        <h1 class="form-title">
            {% if notice %}
                {% if view_only %}
                    查看公告
                {% else %}
                    编辑公告
                {% endif %}
            {% else %}
                添加公告
            {% endif %}
        </h1>
        
        {% with messages = get_flashed_messages(with_categories=true) %}
            {% if messages %}
                {% for category, message in messages %}
                    <div class="alert alert-{{ category }}">
                        {{ message }}
                    </div>
                {% endfor %}
            {% endif %}
        {% endwith %}
        
        {% if view_only %}
            <div class="view-container">
                <div class="view-label">标题</div>
                <div class="view-content">{{ notice.title }}</div>
                
                <div class="view-label">内容</div>
                <div class="view-content notice-content">{{ notice.content }}</div>
                
                <div class="view-label">排序</div>
                <div class="view-content">{{ notice.sort_order }}</div>
                
                <div class="view-label">状态</div>
                <div class="view-content">
                    {% if notice.status == 1 %}
                        <span class="status-badge status-enabled">启用</span>
                    {% else %}
                        <span class="status-badge status-disabled">禁用</span>
                    {% endif %}
                </div>
                
                <div class="view-label">创建时间</div>
                <div class="view-content">{{ notice.create_time.strftime('%Y-%m-%d %H:%M:%S') }}</div>
                
                <div class="btn-container">
                    <a href="{{ url_for('cms.notices_list') }}" class="btn btn-secondary">返回列表</a>
                    <a href="{{ url_for('cms.notice_edit', notice_id=notice.id) }}" class="btn btn-primary">编辑公告</a>
                </div>
            </div>
        {% else %}
            <form method="POST">
                <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
                {% if notice %}
                    <input type="hidden" name="notice_id" value="{{ notice.id }}">
                {% endif %}
                
                <div class="form-group">
                    <label for="title" class="form-label">标题<span class="required-marker">*</span></label>
                    <input type="text" class="form-control" id="title" name="title" value="{{ notice.title if notice else '' }}" required>
                    <small class="form-text">公告标题，建议不超过50个字符</small>
                </div>
                
                <div class="form-group">
                    <label for="content" class="form-label">内容<span class="required-marker">*</span></label>
                    <textarea class="form-control notice-content" id="content" name="content" rows="10" required>{{ notice.content if notice else '' }}</textarea>
                    <small class="form-text">公告详细内容</small>
                </div>
                
                <div class="form-group">
                    <label for="publish_time" class="form-label">发布时间<span class="required-marker">*</span></label>
                    <input type="datetime-local" class="form-control" id="publish_time" name="publish_time" value="{{ notice.publish_time.strftime('%Y-%m-%dT%H:%M') if notice and notice.publish_time else '' }}" required>
                    <small class="form-text">公告发布时间，默认为当前时间</small>
                </div>
                
                <div class="form-group">
                    <label for="end_time" class="form-label">结束时间</label>
                    <input type="datetime-local" class="form-control" id="end_time" name="end_time" value="{{ notice.end_time.strftime('%Y-%m-%dT%H:%M') if notice and notice.end_time else '' }}">
                    <small class="form-text">公告结束展示时间（可选），若不设置则一直展示</small>
                </div>
                
                <div class="form-group">
                    <label class="form-label">重要性<span class="required-marker">*</span></label>
                    <div class="radio-group">
                        <label class="radio-option">
                            <input type="radio" name="is_important" value="1" {% if notice and notice.is_important == 1 %}checked{% endif %}>
                            重要
                        </label>
                        <label class="radio-option">
                            <input type="radio" name="is_important" value="0" {% if not notice or notice.is_important == 0 %}checked{% endif %}>
                            普通
                        </label>
                    </div>
                    <small class="form-text">重要公告会在前台显示时有特殊标记</small>
                </div>
                
                <div class="form-group">
                    <label class="form-label">状态<span class="required-marker">*</span></label>
                    <div class="radio-group">
                        <label class="radio-option">
                            <input type="radio" name="status" value="1" {% if notice and notice.status == 1 or not notice %}checked{% endif %}>
                            启用
                        </label>
                        <label class="radio-option">
                            <input type="radio" name="status" value="0" {% if notice and notice.status == 0 %}checked{% endif %}>
                            禁用
                        </label>
                    </div>
                    <small class="form-text">禁用状态的公告不会在前台显示</small>
                </div>
                
                <div class="btn-container">
                    <a href="{{ url_for('cms.notices_list') }}" class="btn btn-secondary">取消</a>
                    <button type="submit" class="btn btn-primary">保存</button>
                </div>
            </form>
        {% endif %}
    </div>
{% endblock %} 