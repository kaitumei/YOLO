{% extends 'common/front_base.html' %}

{% block title %}【HorizonSafe 界安】 - 密码重置{% endblock %}

{% block css %}
<link href="https://cdn.bootcdn.net/ajax/libs/twitter-bootstrap/5.1.3/css/bootstrap.min.css" rel="stylesheet">
<style>
<link rel="stylesheet" href="{{ url_for('static', filename='front/css/forgot_password.css') }}">
</style>
{% endblock %}

{% block content %}
<div class="reset-card">
    <div class="header">
        <svg class="lock-icon" viewBox="0 0 24 24" fill="currentColor">
            <path d="M12 2C9.243 2 7 4.243 7 7v3H6a2 2 0 0 0-2 2v8a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2v-8a2 2 0 0 0-2-2h-1V7c0-2.757-2.243-5-5-5zm6 12v6H6v-6h12zm-6-1a2 2 0 1 0 0 4 2 2 0 0 0 0-4zM9 7c0-1.654 1.346-3 3-3s3 1.346 3 3v3H9V7z"/>
        </svg>
        <h1 class="h4 mb-0">重置密码</h1>
    </div>

    <form method="POST" id="resetForm">
        {{ form.csrf_token }}
        <div class="mb-4">
            <label class="form-label">电子邮箱</label>
            <div class="input-wrapper">
                <input
                    type="email"
                    class="form-control"
                    name="email"
                    required
                    placeholder="请输入注册邮箱"
                    pattern="[a-z0-9._%+-]+@[a-z0-9.-]+\.[a-z]{2,4}$"
                >
            </div>
            <div class="error-feedback">
                {% for error in form.email.errors %}
                    {{ error }}
                {% endfor %}
            </div>
        </div>

        <button type="submit" class="btn submit-btn">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="white" class="me-2">
                <path d="M20 4H4c-1.1 0-1.99.9-1.99 2L2 18c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2zm0 14H4V8l8 5 8-5v10zm-8-7L4 6h16l-8 5z"/>
            </svg>
            发送重置链接
        </button>
    </form>

    <!-- 返回登录页按钮 -->
    <button class="back-to-login-btn" onclick="location.href='/login'">
        ← 返回登录页
    </button>
</div>
{% endblock %}

{% block js %}
<script>
    const form = document.getElementById('resetForm');
    const emailInput = form.querySelector('input[type="email"]');
    const errorFeedback = document.querySelector('.error-feedback');

    // 实时邮箱验证
    function validateEmail() {
        const isValid = emailInput.checkValidity();
        errorFeedback.classList.toggle('show-error', !isValid);
        emailInput.parentElement.style.borderColor = isValid ? 'var(--primary-blue)' : 'var(--error)';
    }

    // 输入时验证
    emailInput.addEventListener('input', validateEmail);

    // 表单提交处理
    form.addEventListener('submit', (e) => {
        if (!emailInput.checkValidity()) {
            e.preventDefault();
            errorFeedback.textContent = '请输入有效的邮箱地址';
            errorFeedback.classList.add('show-error');
        }
    });
</script>
{% endblock %}