{% extends 'common/front_base.html' %}

{% block title %}视频列表{% endblock %}

{% block css %}
<style>
    .video-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
        gap: 20px;
        margin-top: 20px;
    }
    
    .video-card {
        border: 1px solid #eee;
        border-radius: 10px;
        overflow: hidden;
        transition: all 0.3s;
        box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    }
    
    .video-card:hover {
        transform: translateY(-5px);
        box-shadow: 0 5px 15px rgba(0,0,0,0.15);
    }
    
    .video-thumbnail {
        width: 100%;
        height: 180px;
        background-color: #f5f5f5;
        position: relative;
        display: flex;
        align-items: center;
        justify-content: center;
    }
    
    .video-thumbnail svg {
        width: 50px;
        height: 50px;
        fill: #999;
    }
    
    .video-info {
        padding: 15px;
    }
    
    .video-title {
        font-size: 16px;
        font-weight: bold;
        margin-bottom: 5px;
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
    }
    
    .video-meta {
        color: #666;
        font-size: 14px;
        margin-bottom: 10px;
    }
    
    .video-type {
        display: inline-block;
        padding: 3px 8px;
        border-radius: 10px;
        font-size: 12px;
        margin-right: 5px;
    }
    
    .video-type.original {
        background-color: #e3f2fd;
        color: #1565c0;
    }
    
    .video-type.processed {
        background-color: #e8f5e9;
        color: #2e7d32;
    }
    
    .video-type.record {
        background-color: #fff3e0;
        color: #e65100;
    }
    
    .video-actions {
        display: flex;
        justify-content: space-between;
        margin-top: 10px;
    }
    
    .video-btn {
        padding: 5px 12px;
        border-radius: 5px;
        text-decoration: none;
        border: none;
        cursor: pointer;
        font-size: 14px;
    }
    
    .play-btn {
        background-color: #4CAF50;
        color: white;
    }
    
    .download-btn {
        background-color: #2196F3;
        color: white;
    }
    
    .filter-tabs {
        display: flex;
        gap: 10px;
        margin-bottom: 20px;
        flex-wrap: wrap;
    }
    
    .filter-tab {
        padding: 8px 15px;
        border-radius: 20px;
        cursor: pointer;
        background-color: #f5f5f5;
        transition: all 0.3s;
    }
    
    .filter-tab:hover {
        background-color: #e0e0e0;
    }
    
    .filter-tab.active {
        background-color: #2196F3;
        color: white;
    }
    
    .video-placeholder {
        text-align: center;
        padding: 50px;
        background-color: #f9f9f9;
        border-radius: 10px;
        margin-top: 20px;
    }
</style>
{% endblock %}

{% block content %}
<div class="container mt-4">
    <h2>视频列表</h2>
    
    {% if error %}
    <div class="alert alert-danger">
        <strong>错误:</strong> {{ error }}
    </div>
    {% endif %}
    
    <div class="filter-tabs" role="tablist" aria-label="视频类型筛选">
        <div class="filter-tab active" data-filter="all" role="tab" aria-selected="true" tabindex="0" aria-controls="video-grid">所有视频</div>
        <div class="filter-tab" data-filter="original" role="tab" aria-selected="false" tabindex="0" aria-controls="video-grid">原始视频</div>
        <div class="filter-tab" data-filter="processed" role="tab" aria-selected="false" tabindex="0" aria-controls="video-grid">处理后视频</div>
        <div class="filter-tab" data-filter="record" role="tab" aria-selected="false" tabindex="0" aria-controls="video-grid">检测记录视频</div>
    </div>
    
    {% if videos %}
    <div class="video-grid" id="video-grid" role="tabpanel">
        {% for video in videos %}
        <div class="video-card" data-type="{{ video.type }}">
            <div class="video-thumbnail">
                <svg viewBox="0 0 24 24" aria-labelledby="videoIconTitle" role="img">
                    <title id="videoIconTitle">视频文件</title>
                    <path d="M17 10.5V7c0-.55-.45-1-1-1H4c-.55 0-1 .45-1 1v10c0 .55.45 1 1 1h12c.55 0 1-.45 1-1v-3.5l4 4v-11l-4 4z"/>
                </svg>
            </div>
            <div class="video-info">
                <div class="video-title" title="{{ video.filename }}">{{ video.filename }}</div>
                <div class="video-meta">
                    <span class="video-type {{ video.type }}">{{ video.type }}</span>
                    <span>{{ video.size_formatted }}</span>
                </div>
                <div class="video-meta">
                    创建时间: {{ video.created_at_formatted }}
                </div>
                <div class="video-actions">
                    <a href="{{ url_for('check.stream_video', filename=video.filename) }}" class="video-btn play-btn" target="_blank" title="播放视频: {{ video.filename }}">播放</a>
                    <a href="{{ video.download_url }}" class="video-btn download-btn" title="下载视频: {{ video.filename }}">下载</a>
                </div>
            </div>
        </div>
        {% endfor %}
    </div>
    {% else %}
    <div class="video-placeholder">
        <h3>没有找到视频</h3>
        <p>您尚未上传或处理任何视频文件。</p>
    </div>
    {% endif %}
</div>
{% endblock %}

{% block js %}
<script>
    document.addEventListener('DOMContentLoaded', function() {
        // 过滤功能
        const filterTabs = document.querySelectorAll('.filter-tab');
        
        filterTabs.forEach(tab => {
            tab.addEventListener('click', function() {
                activateTab(this);
            });
            
            // 添加键盘支持
            tab.addEventListener('keydown', function(e) {
                // 当按下回车或空格时激活标签
                if (e.key === 'Enter' || e.key === ' ') {
                    e.preventDefault();
                    activateTab(this);
                }
            });
        });
        
        function activateTab(tab) {
            // 移除所有active类
            filterTabs.forEach(t => {
                t.classList.remove('active');
                t.setAttribute('aria-selected', 'false');
            });
            
            // 添加当前tab的active类
            tab.classList.add('active');
            tab.setAttribute('aria-selected', 'true');
            
            const filter = tab.getAttribute('data-filter');
            filterVideos(filter);
            
            // 宣布状态变化 (可访问性)
            const statusMessage = `已筛选: ${tab.textContent}`;
            announceToScreenReader(statusMessage);
        }
        
        function filterVideos(filter) {
            const videos = document.querySelectorAll('.video-card');
            
            videos.forEach(video => {
                if (filter === 'all' || video.getAttribute('data-type') === filter) {
                    video.style.display = 'block';
                } else {
                    video.style.display = 'none';
                }
            });
        }
        
        // 用于屏幕阅读器的状态通知
        function announceToScreenReader(message) {
            let statusElement = document.getElementById('filter-status');
            if (!statusElement) {
                statusElement = document.createElement('div');
                statusElement.id = 'filter-status';
                statusElement.setAttribute('role', 'status');
                statusElement.setAttribute('aria-live', 'polite');
                statusElement.className = 'visually-hidden';
                document.body.appendChild(statusElement);
            }
            statusElement.textContent = message;
        }
    });
</script>
{% endblock %} 